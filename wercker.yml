box: 
  id: php:5.6.26-apache

build:
  steps:
    - install-packages:
        packages: openssl zlib1g-dev sshpass
    - script:
        name: get composer
        code: curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
    - script:
        name: install exts
        code: docker-php-ext-install pdo mbstring zip
    - script:
        name: composer install
        code: composer install
    - script:
        name: copy env
        code: cp .env.example .env
    - script:
        name: generate key
        code: php artisan key:generate
    - script:
        name: phpunit
        code: vendor/bin/phpunit
        
deploy:
  steps:
    - script:
        name: clean vendor
        code: |
          rm -rf vendor
          rm -rf node_modules
          rm .env
    - script:
        name: transfer application
        code: sshpass -p $DEPLOY_PASS scp -r -o stricthostkeychecking=no * $DEPLOY_USER@$DEPLOY_HOST:$DEPLOY_PATH
